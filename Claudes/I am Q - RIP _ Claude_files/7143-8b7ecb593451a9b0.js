"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7143],{9234:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(54568),a=n(7620);let s=(0,a.forwardRef)((e,t)=>{let{className:n,children:s,disabled:r,noDefaultScroll:l}=e,i=(0,a.useRef)(0),c=(0,a.useRef)(!0),d=(0,a.useRef)(null),u=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(d.current&&c.current&&!(d.current.scrollHeight-d.current.clientHeight<d.current.scrollTop)&&d.current&&"function"==typeof d.current.scrollTo){var t,n,o;null==(o=d.current)||o.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)-(null==(n=d.current)?void 0:n.clientHeight)+5,behavior:e})}},[]),p=(0,a.useCallback)(e=>{if(d.current&&d.current&&"function"==typeof d.current.scrollTo){var t,n,o;d.current.style.overflow="hidden",null==(o=d.current)||o.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)*e-(null==(n=d.current)?void 0:n.clientHeight)/2,behavior:"auto"})}},[]),h=(0,a.useCallback)(()=>{d.current&&(d.current.style.overflow="")},[]);return(0,a.useImperativeHandle)(t,()=>({reset(){i.current=0,c.current=!0,l||u()},scrollToBottomIfPinned:u,scrollToPercentage:p,enableScrolling:h}),[u,p,h,l]),(0,a.useLayoutEffect)(()=>{r||!s||l||u()},[s,r,u,l]),(0,o.jsx)("div",{className:n,onScroll:e=>{if(r)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(d.current,t),o=t>i.current;n&&o?c.current=!0:n||o||(c.current=!1),i.current=t},ref:d,children:s})});s.displayName="AutoScroll"},19544:(e,t,n)=>{n.d(t,{A:()=>w});var o=n(54568),a=n(41417),s=n(37076),r=n(46760),l=n(62971);let i=e=>{let{isOpen:t=!1,filename:n,onClose:i,onConfirm:c}=e,d=(0,r.A)();return(0,o.jsxs)(s.aF,{title:d.formatMessage({defaultMessage:"Download file",id:"k9qHCCLPA5"}),isOpen:t,onClose:i,children:[(0,o.jsxs)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:[(0,o.jsx)(l.A,{defaultMessage:"Artifacts are created by other users and aren’t verified by Anthropic. Only download files you trust.",id:"MDebIUeu03"}),(0,o.jsx)("pre",{className:"font-mono text-wrap text-sm p-2 my-2 rounded border border-border-400 bg-bg-000",children:n})]}),(0,o.jsxs)(s.vW,{children:[(0,o.jsx)(a.$,{variant:"secondary",onClick:i,children:(0,o.jsx)(l.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,o.jsx)(a.$,{onClick:c,children:(0,o.jsx)(l.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})]})]})};var c=n(94649),d=n(10158),u=n(1761),p=n(27062),h=n(70825),m=n(32987),g=n(49645),f=n(37463),x=n(7620),b=n(21155),y=n(20810),v=n(44124),C=n(53120);let w=(0,x.forwardRef)((e,t)=>{let{content:n,className:s,type:w,onSandboxConfirmation:S,onDOMContentLoaded:z,capabilities:R,onReportError:q,onSetContent:j,onRefresh:M,externalLinkBehavior:E,onOpenExternalLinkRequest:k,onTrackInteraction:P,showLoginModal:O,lazy:A=!0,zoom:F=1,artifactContext:N,ArtifactMcpModal:T}=e,L=(0,r.A)(),{userContentRendererUrl:I}=(0,d._r)(),{value:D}=(0,p.fS)("claude_create_marble"),[U,H]=(0,x.useState)(!1),_=(0,x.useRef)(null),G="".concat(I).concat((null==N?void 0:N.uuid)&&"published_artifact"===N.type?"/artifact/"+N.uuid:"").concat(q?"?errorReportingMode=parent":"");(0,x.useEffect)(()=>{let e=_.current;e&&navigator.userAgent.toLowerCase().includes("firefox")&&(e.setAttribute("data-no-service-worker","true"),setTimeout(()=>{e.sandbox&&e.src&&(e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("referrerpolicy","no-referrer"))},0))},[]);let[Z,B]=(0,x.useState)(null),[K,W]=(0,x.useState)(null),[J,V]=(0,x.useState)(null),{activeOrganization:Q}=(0,u.YL)(),{value:X}=(0,p.fS)("apps_use_turmeric"),{value:$}=(0,p.fS)("artifact_tailwind_styles"),[Y,ee]=(0,x.useState)(0),{sendRequest:et,updatePermission:en}=function(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:o=null,initialPermissions:a,onPermissionRequested:s,onCapabilityAction:r}=e,[l,i]=(0,x.useState)(null),c=(0,x.useRef)(a),[d,u]=(0,x.useState)(0);(0,x.useEffect)(()=>{if(!t.current&&d<20){let e=setTimeout(()=>{u(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void console.warn("Max retries reached while waiting for iframe");let e=new C.x({iframe:t.current,allowedOrigin:n,onRateLimited:o,onPermissionRequested:async e=>{if(b.tH.includes(e)||"accepted"===c.current[e])return"accepted";let t=await s(e);return c.current={...c.current,[e]:t},t},onCapabilityAction:r});return i(e),()=>{e.cleanup()}},[t,n,c,o,s,r,d]);let p=(0,x.useCallback)(async(e,t)=>{if(l)return l.sendRequest(e,t);throw Error("Communicator not initialized")},[l]),h=(0,x.useCallback)(()=>{null==l||l.restartListening()},[l]),m=(0,x.useCallback)((e,t)=>{c.current={...c.current,[e]:t}},[]);return{sendRequest:null===l?void 0:p,restartListening:h,permissions:c.current,updatePermission:m}}({iframeRef:_,allowedOrigin:I,onCapabilityAction:(0,x.useCallback)(async(e,t)=>{if(e.method===b.uZ.ReadyForContent)return H(!0),null==S||S(),Promise.resolve();if(e.method===b.uZ.GetFile)return R&&R.getFile?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await R.getFile(e.payload.key)}:Promise.reject();if(e.method===b.uZ.SendConversationMessage)return R&&R.sendMessage?(await R.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===b.uZ.ClaudeCompletion)return R&&R.claudeComplete?(ee(e=>e+1),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await R.claudeComplete(e.payload.prompt)}):Promise.reject();if(e.method===b.uZ.BroadcastContentSize);else if(e.method===b.uZ.DOMContentLoaded)return null==z||z(),Promise.resolve();else if(e.method===b.uZ.OpenExternal){if("ask"===E)return B(e.payload.href),Promise.resolve();if("bubble"===E&&k)return k({href:e.payload.href}),Promise.resolve()}else if(e.method===b.uZ.DownloadFile)return W(e.payload),Promise.resolve();else if(e.method===b.uZ.ReportError)return null==q||q(e.payload.error),Promise.resolve();else if(e.method===b.uZ.TrackInteraction)return null==P||P(e.payload),Promise.resolve();else if(e.method===b.uZ.ProxyFetch)return(null==Q?void 0:Q.uuid)?(0,y._)(e.payload,t,null==Q?void 0:Q.uuid,N,D,V):(null==O||O(),Promise.reject());return Promise.reject()},[S,z,R,H,q,ee,E,k,P,O,null==Q?void 0:Q.uuid,N,D]),onPermissionRequested:(0,x.useCallback)(async e=>e===b.uZ.ClaudeCompletion&&Y>=100?"denied":Promise.resolve("accepted"),[Y]),initialPermissions:{}});(0,x.useEffect)(()=>{Y>=100&&(en(b.uZ.ClaudeCompletion,"denied"),(0,h.wd)("Claude completion request limit hit."))},[Y,en]);let eo=(0,x.useCallback)(()=>{(0,h.wd)("Claude completion modal confirmed"),ee(0),en(b.uZ.ClaudeCompletion,"accepted")},[en]),ea=(0,x.useCallback)(async()=>{let e=await (null==et?void 0:et(b.uZ.GetScreenshot,v.qs));if(null==e?void 0:e.screenshot){if(e.screenshot.length>0xa00000)throw Error(L.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(L.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[L,et]),es=(0,x.useCallback)(async()=>{let e=await (null==et?void 0:et(b.uZ.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[et]),er=(0,x.useCallback)(async()=>{let e=await (null==et?void 0:et(b.uZ.GetDOMSnapshot,v.qs));return(null==e?void 0:e.domSnapshot)||void 0},[et]);return(0,x.useEffect)(()=>{U&&n&&w&&(null==j||j(),null==et||et(b.uZ.SetContent,{content:n,type:w,tailwindStylesEnabled:$,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[n,et,w,U,j,$]),(0,x.useImperativeHandle)(t,()=>({refresh:()=>{null==M||M(),H(!1);let e=_.current;if(e){let t=e.parentNode;t?(t.removeChild(e),e.removeAttribute("src"),e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("data-no-service-worker","true"),e.setAttribute("referrerpolicy","no-referrer"),e.src=G,t.appendChild(e)):e.src=G}},getScreenshot:ea,copyHtmlContent:es,getDOMSnapshot:er})),(0,o.jsxs)("div",{className:(0,m.A)("relative",s),children:[(0,o.jsx)("iframe",{ref:_,className:"h-full w-full",style:{zoom:F},sandbox:"allow-scripts allow-same-origin",title:L.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:A?"lazy":void 0,src:G,allow:"fullscreen; clipboard-write",referrerPolicy:"no-referrer"}),(0,o.jsx)(g.N,{children:!U&&(0,o.jsx)(f.P.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),Z?(0,o.jsx)(c.v,{isOpen:!!Z,url:Z,onClose:()=>B(null),onConfirm:()=>{Z&&window.open(Z,"_blank"),B(null)}}):null,K?(0,o.jsx)(i,{isOpen:!!K,filename:K.filename,onClose:()=>W(null),onConfirm:()=>{if(K){let e=new Blob([K.data],{type:K.mimeType}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=K.filename,n.click(),URL.revokeObjectURL(t)}W(null)}}):null,J&&T&&N?(0,o.jsx)(T,{isOpen:!!J,requestedServers:J.requestedServers,onClose:()=>{J.onClose(),V(null)},artifactContext:N}):null,X&&Y>=100&&(0,o.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,o.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,o.jsx)("p",{className:"text-fg-100 mb-4",children:(0,o.jsx)(l.A,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,o.jsx)(a.$,{onClick:eo,variant:"primary",children:(0,o.jsx)(l.A,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});w.displayName="RichSandbox"},20810:(e,t,n)=>{n.d(t,{_:()=>d});var o=n(21155),a=n(75006);let s=a.z.object({name:a.z.string().optional(),url:a.z.string().optional(),type:a.z.string().optional()}),r=new Set(["accept","accept-language","content-type","content-length"]),l=new Set(["set-cookie","x-api-key","x-auth-token","authorization"]),i=["api.anthropic.com"],c={"api.anthropic.com":async(e,t)=>await fetch("/api/organizations/".concat(e,"/proxy/v1/messages"),t)};async function d(e,t,n,o,d,p){let h,{url:m,method:g,headers:f,body:x,channelId:b}=e,y=new URL(m),v={};for(let[e,t]of Object.entries(f))r.has(e.toLowerCase())&&(v[e]=t);o&&(v["anthropic-artifact-id"]=o.uuid,v["anthropic-artifact-entity-type"]=o.type);let C=x;if(p&&d&&x&&i.some(e=>e===y.hostname)){let e=new TextDecoder().decode(x),t=a.z.object({mcp_servers:a.z.array(s).optional()}).passthrough().parse(JSON.parse(e));if(t.mcp_servers&&Array.isArray(t.mcp_servers)){let e=t.mcp_servers.filter(e=>e.url);if(e.length>0){let t=new Promise(t=>{p({requestedServers:e,onClose:()=>t()})});await t}let n=new TextEncoder().encode(JSON.stringify(t));C=n.buffer instanceof ArrayBuffer?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):new ArrayBuffer(0)}}let w=new AbortController;if(y.hostname in c)h=await c[y.hostname](n||"",{method:g,headers:v,body:C||void 0,signal:w.signal,redirect:"manual"});else throw Error("Unable to proxy requests for ".concat(y.hostname,"."));let S={};return h.headers.forEach((e,t)=>{l.has(t.toLowerCase())||(S[t]=e)}),u(h,b,t),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse",status:h.status,statusText:h.statusText,headers:S}}async function u(e,t,n){var a;let s=null==(a=e.body)?void 0:a.getReader();if(!s)return void await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});let r=0;try{for(;;){let{done:e,value:a}=await s.read();if(e){await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});break}if(a){let e;if((r+=a.byteLength)>0xa00000)throw Error("Response body exceeds maximum size of ".concat(0xa00000," bytes"));let s=0===a.byteOffset&&a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);e=s instanceof ArrayBuffer?s:new Uint8Array(s).slice().buffer,await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:e,done:!1},[e])}}}catch(e){await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{s.releaseLock()}}},21155:(e,t,n)=>{n.d(t,{K_:()=>g,Ub:()=>h,tH:()=>b,uZ:()=>r,v9:()=>x,x8:()=>f,zN:()=>p});var o=n(54890),a=n(75006),s=n(44124),r=function(e){return e.ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",e.SetContent="anthropic.claude.usercontent.sandbox.SetContent",e.GetFile="anthropic.claude.usercontent.sandbox.GetFile",e.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",e.RunCode="anthropic.claude.usercontent.sandbox.RunCode",e.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",e.ReportError="anthropic.claude.usercontent.sandbox.ReportError",e.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",e.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize",e.OpenExternal="anthropic.claude.usercontent.sandbox.OpenExternal",e.DownloadFile="anthropic.claude.usercontent.sandbox.DownloadFile",e.CopyHtmlContent="anthropic.claude.usercontent.sandbox.CopyHtmlContent",e.TrackInteraction="anthropic.claude.usercontent.sandbox.TrackInteraction",e.ProxyFetch="anthropic.claude.usercontent.sandbox.ProxyFetch",e.ProxyFetchStream="anthropic.claude.usercontent.sandbox.ProxyFetchStream",e.GetDOMSnapshot="anthropic.claude.usercontent.sandbox.GetDOMSnapshot",e.DOMContentLoaded="anthropic.claude.usercontent.sandbox.DOMContentLoaded",e}({});let l=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),i=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),c=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),u=a.z.discriminatedUnion("type",[l,i,c,d]),p=a.z.object({code:a.z.string()}),h=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),m={"anthropic.claude.usercontent.sandbox.CopyHtmlContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.CopyHtmlContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse"),reportHTMLContent:a.z.string()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.union([a.z.nativeEnum(o.vU),a.z.nativeEnum(o.qK)]),watchContentSize:a.z.boolean().optional(),tailwindStylesEnabled:a.z.boolean().optional()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.z.number(),width:a.z.number()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(h)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:u})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({screenshot:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.OpenExternal":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.OpenExternal"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"),href:a.z.string()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.DownloadFile":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.DownloadFile"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile"),filename:a.z.string(),data:a.z.instanceof(ArrayBuffer),mimeType:a.z.string()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.TrackInteraction":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.TrackInteraction"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.TrackInteraction"),interactionType:a.z.literal("click")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.ProxyFetch":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetch"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchRequest"),url:a.z.string(),method:a.z.string(),headers:a.z.record(a.z.string()),body:a.z.instanceof(ArrayBuffer).nullable(),channelId:a.z.string()})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse"),status:a.z.number(),statusText:a.z.string(),headers:a.z.record(a.z.string())})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ProxyFetchStream":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetchStream"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest"),channelId:a.z.string(),chunk:a.z.instanceof(ArrayBuffer).nullable(),done:a.z.boolean(),error:a.z.string().optional()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetDOMSnapshot":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetDOMSnapshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetDOMSnapshotResponse"),domSnapshot:a.z.string().nullable()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.DOMContentLoaded":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.DOMContentLoaded"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0}},g=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize","anthropic.claude.usercontent.sandbox.OpenExternal","anthropic.claude.usercontent.sandbox.DownloadFile","anthropic.claude.usercontent.sandbox.TrackInteraction","anthropic.claude.usercontent.sandbox.ProxyFetch","anthropic.claude.usercontent.sandbox.DOMContentLoaded"]),f=a.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,m["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,m["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema,m["anthropic.claude.usercontent.sandbox.OpenExternal"].requestSchema,m["anthropic.claude.usercontent.sandbox.DownloadFile"].requestSchema,m["anthropic.claude.usercontent.sandbox.TrackInteraction"].requestSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetch"].requestSchema,m["anthropic.claude.usercontent.sandbox.DOMContentLoaded"].requestSchema]);a.z.union([s.gq,m["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetch"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot","anthropic.claude.usercontent.sandbox.CopyHtmlContent","anthropic.claude.usercontent.sandbox.ProxyFetchStream","anthropic.claude.usercontent.sandbox.GetDOMSnapshot"]),a.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema,m["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].requestSchema]);let x=a.z.union([m["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,m["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema,m["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].responseSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].responseSchema,m["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].responseSchema]),b=Object.entries(m).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},27143:(e,t,n)=>{n.d(t,{CodeRenderer:()=>E,k:()=>M,MarkdownRenderer:()=>k});var o=n(54568),a=n(56340),s=n(1336),r=n(74610),l=n(89697),i=n(9234),c=n(54890),d=n(92007),u=n(32987),p=n(7620),h=n(92479),m=n(47546),g=n(41417),f=n(91961),x=n(16566),b=n(24600),y=n(49645),v=n(37463),C=n(46760),w=n(62971);let S=e=>{let{isStreaming:t,children:n,...a}=e;return t?n:(0,o.jsx)(z,{...a,children:n})},z=e=>{let{children:t,sendMessage:n,contentType:a="text",isOpen:s}=e,r=(0,C.A)(),l=void 0!==n,[i,c]=(0,p.useState)([]),[d,h]=(0,p.useState)({top:0,left:0,width:0}),[S,z]=(0,p.useState)(!1),[R,q]=(0,p.useState)(!1),[j,M]=(0,p.useState)(""),[E,k]=(0,p.useState)(""),[P,O]=(0,p.useState)(!1),A=(0,p.useRef)(null),F=(0,p.useRef)(null),N=(0,p.useCallback)((e,t)=>{var n;let o=function(e,t){let n=[];for(let o=0;o<e.rangeCount;o++){let a=e.getRangeAt(o);if(a.startContainer===a.endContainer&&a.startContainer.nodeType===Node.TEXT_NODE){let e=a.startContainer,t=document.createRange();for(let o=a.startOffset;o<a.endOffset;o++){t.setStart(e,o),t.setEnd(e,o+1);let a=Array.from(t.getClientRects());n.push(...a)}t.detach()}else{let e=function(e){let t,n=[],o=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=o.nextNode();)n.push(t);return n}(a);e.forEach((o,s)=>{let r=document.createRange(),l="length"in o?o.length:0,i=0===s,c=s===e.length-1,d=i?a.startOffset:0,u=c&&!t?a.endOffset:l;r.setStart(o,d),r.setEnd(o,u);let p=Array.from(r.getClientRects());n.push(...p),r.detach()})}}return n}(e,t),a=null==(n=A.current)?void 0:n.getBoundingClientRect();return Array.from(o).map(e=>({top:e.top-((null==a?void 0:a.top)||0)-2.5,left:e.left-((null==a?void 0:a.left)||0),width:e.width,height:e.height+5.5}))},[]),T=(0,p.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null==(t=A.current)?void 0:t.contains(n.commonAncestorContainer)},[]);(0,p.useEffect)(()=>{function e(e){var t,n,o,a;let s,r,{selection:l,isSelectAll:i}=e,d=N(l,i);if(d.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let e=Math.max(...d.map(e=>e.left+e.width));s=d[0].top-9,r=e+10}else{let e=Math.max(...d.map(e=>e.top+e.height));r=Math.min(...d.map(e=>e.left)),s=Math.min((null!=(o=null==(n=A.current)?void 0:n.scrollHeight)?o:0)-50,e)}let u=((null!=(a=null==(t=A.current)?void 0:t.scrollWidth)?a:1e3)-r)/3*2;c(d),z(!0),q(!1),h({top:s,left:r,width:u}),k(l.toString())}let t=()=>{O(!0)},n=t=>{"Escape"===t.key&&(q(!1),z(!1),M(""),c([]));let n=((0,f.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,o=A.current;if(o&&s&&n){let n=document.activeElement&&(document.activeElement===o||(null==o?void 0:o.contains(document.activeElement))),a=window.getSelection();if(n&&a){t.preventDefault();let n=document.createRange();n.selectNodeContents(o),a.removeAllRanges(),a.addRange(n),e({selection:a,isSelectAll:!0})}}},o=t=>{if(F.current&&F.current.contains(t.target))return;let n=window.getSelection();n&&!n.isCollapsed&&T(n)?e({selection:n}):(c([]),z(!1),q(!1),k(""),M("")),O(!1)};return l&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",o),document.addEventListener("keydown",n)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",o),document.removeEventListener("keydown",n)}},[N,T,l,s]);let L=e=>{l&&(n(e),M(""),q(!1),z(!1),c([]))},I=()=>"text"===a?E.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===a?"```\n".concat(E,"\n```"):void 0,D=()=>{L({prompt:"".concat(I(),"\n\n").concat(j),attachments:[],files:[],syncSources:[]})};return(0,o.jsxs)("div",{className:"w-full h-full relative",children:[(0,o.jsx)("div",{ref:A,tabIndex:0,className:(0,u.$)("w-full h-full relative",l?P?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),i.map((e,t)=>(0,o.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,o.jsx)(y.N,{children:S&&!R&&(0,o.jsx)(v.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:d.top+5,left:d.left},children:(0,o.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,o.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,o.jsxs)(m.k,{onClick:()=>{q(!0)},isAssistant:!0,children:[(0,o.jsx)(x.f,{size:16}),(0,o.jsx)(w.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})]}),(0,o.jsxs)(m.k,{onClick:()=>{L({prompt:"".concat(r.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(I()),attachments:[],files:[],syncSources:[]})},isAssistant:!0,children:[(0,o.jsx)(b.g,{size:16}),(0,o.jsx)(w.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})]})]})})})}),(0,o.jsx)(y.N,{children:R&&(0,o.jsxs)(v.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:d.top+5,left:d.left,width:d.width},ref:F,onSubmit:e=>{e.preventDefault(),D()},children:[(0,o.jsx)("input",{type:"text",value:j,onChange:e=>M(e.target.value),placeholder:r.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,o.jsx)(y.N,{children:j.trim().length>0?(0,o.jsx)(v.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,o.jsx)(g.$,{onClick:()=>D(),"aria-label":r.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,o.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,o.jsx)(w.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var R=n(53029),q=n(19544);let j="opacity-30 blur-[2px]",M=e=>{let{isOpen:t,content:n,language:a,citations:s,type:r,showRaw:l,richSandboxRef:d,isCurrentStreaming:h,isChatStreaming:m,onSandboxConfirmation:g,onDOMContentLoaded:f,sendMessage:x,richSandboxCapabilities:b,isLatestVersion:y,artifactId:v,artifactContext:C,artifactVersion:w,onArtifactRuntimeError:S,artifact:z,hasMenuOpen:M,zoom:O,onTrackInteraction:A,showLoginModal:F,ArtifactMcpModal:N}=e,T=void 0!==r&&void 0!==n&&r!==c.vU.Code&&r!==c.vU.Markdown,L=(0,p.useRef)(null),I=T&&!l,[D,U]=(0,p.useState)(null),H=(0,p.useCallback)(e=>{void 0!==v&&void 0!==w&&(void 0!==S&&S(e),U({error:e,artifactId:v,artifactVersion:w}))},[v,w,S]);(0,p.useEffect)(()=>{var e;if(!z||!h)return;let t=z.versions[z.versions.length-1],n=z.versions[z.versions.length-2];if(!n||!t||"update"!==t.command)return;let o=P(n.resultState,t.resultState);-1!==o&&(null==(e=L.current)||e.scrollToPercentage(o/100))},[n,z,h]),(0,p.useEffect)(()=>{!h&&L.current&&L.current.enableScrolling()},[h]);let _=(0,p.useCallback)(()=>{U(e=>e&&(e.artifactId!==v||e.artifactVersion!==w)?null:e)},[v,w]),G=(0,p.useCallback)(()=>{U(null)},[]);return(0,o.jsxs)(o.Fragment,{children:[T&&(0,o.jsxs)("div",{className:(0,u.A)("ease-out duration-200",I?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",M&&j),children:[(0,o.jsx)(q.A,{ref:d,className:I?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:I?n:void 0,type:I?r:void 0,onSandboxConfirmation:g,onDOMContentLoaded:f,capabilities:b,onReportError:H,onSetContent:_,onRefresh:G,externalLinkBehavior:"ask",zoom:O,onTrackInteraction:A,showLoginModal:F,artifactContext:C,ArtifactMcpModal:N}),I&&D&&(0,o.jsx)(R.i,{error:D,handleClose:()=>U(null),sendMessage:y?x:void 0,isStreaming:m})]}),void 0===n||void 0===r?null:r===c.vU.Code||l?(0,o.jsx)(i.Z,{noDefaultScroll:!h,ref:L,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",M&&j),children:(0,o.jsx)(E,{content:n,isStreaming:m,language:a,sendMessage:x,isOpen:t},"code-".concat(v,"-").concat(w,"-").concat(h))}):r===c.vU.Markdown?(0,o.jsx)(i.Z,{noDefaultScroll:!h,ref:L,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",M&&j),children:(0,o.jsx)(k,{content:n,citations:s,isStreaming:m,sendMessage:x,isOpen:t},"markdown-".concat(v,"-").concat(w,"-").concat(h))}):null]})},E=e=>{let{content:t,isStreaming:n,language:s,sendMessage:r,isOpen:i}=e,{codeStyle:c}=(0,l.V)();return(0,o.jsx)(S,{isStreaming:n,sendMessage:r,contentType:"code",isOpen:i,children:(0,o.jsx)(h.A,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:s,PreTag:"div",style:c,renderer:a.G,children:t})})},k=e=>{let{content:t,citations:n,isStreaming:a,sendMessage:l,isOpen:i}=e,c=(0,d.n)(),u=(0,p.useMemo)(()=>c&&n&&n.length>0?(0,r.k0)(n,t):t,[t,n,c]);return(0,o.jsx)(S,{isStreaming:a,sendMessage:l,isOpen:i,children:(0,o.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] -tracking-[0.015em] px-6 pt-4 md:pt-6 md:px-11",children:[(0,o.jsx)(s.fP,{text:u,blockCitations:n,className:"!gap-3.5"}),(0,o.jsx)("div",{className:"h-8"})]})})},P=(e,t)=>{if(!e||!t)return -1;let n=e.replace(/\\n/g,"\n"),o=t.replace(/\\n/g,"\n"),a=[...n].findIndex((e,t)=>e!==o[t]);if(-1===a&&n.length===o.length)return -1;let s=(n.slice(0,-1===a?n.length:a).match(/\n/g)||[]).length,r=(n.match(/\n/g)||[]).length;return r?Math.round(s/r*100):-1}},44124:(e,t,n)=>{n.d(t,{Ko:()=>r,SV:()=>d,Uq:()=>s,_s:()=>a,gq:()=>i,qs:()=>c,t6:()=>l});var o=n(75006);let a=o.z.object({channel:o.z.enum(["request","response"]),requestId:o.z.string()}).passthrough(),s=a.strict().extend({channel:o.z.literal("request"),method:o.z.string(),payload:o.z.strictObject({"@type":o.z.string()})}),r=a.extend({channel:o.z.literal("response"),status:o.z.number().int().min(100).max(599),payload:o.z.strictObject({"@type":o.z.string()}).passthrough()}).passthrough(),l=r.extend({status:o.z.number().int().min(400).max(599),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:o.z.string()})}),i=r.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),c={"@type":"type.googleapis.com/google.protobuf.Empty"},d=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},47546:(e,t,n)=>{n.d(t,{k:()=>r});var o=n(54568),a=n(12072),s=n(32987);function r(e){let{Icon:t,children:n,isAssistant:r=!0,tooltipContent:l,...i}=e;return(0,o.jsx)(a.m,{className:"mt-1",side:"bottom",delayDuration:100,tooltipContent:l,disableHoverableContent:!0,children:(0,o.jsxs)("button",{...i,className:(0,s.A)("flex flex-row items-center gap-1.5 rounded-md p-2 text-sm transition text-text-300 active:scale-95","select-auto",r?"hover:bg-bg-300 py-1.5":"hover:bg-bg-500 py-1",i.className),children:[t,n]})})}n(7620)},53029:(e,t,n)=>{n.d(t,{i:()=>c});var o=n(54568),a=n(7620),s=n(46760),r=n(41417),l=n(76761);let i=e=>{let{handleClose:t,title:n,description:a,inset:s,action:i}=e;return(0,o.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,o.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:n}),(0,o.jsx)("p",{className:"mb-2 text-sm",children:a}),!!s&&(0,o.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:s}),i&&(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)(r.$,{variant:"primary",className:"mt-4 text-sm",onClick:i.onClick,disabled:i.disabled,loading:i.loading,children:i.label})}),(0,o.jsx)("div",{className:"absolute top-2 right-2",children:(0,o.jsx)(r.$,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,o.jsx)(l.X,{})})})]})},c=e=>{var t,n,r;let{error:l,handleClose:c,sendMessage:d,isStreaming:u}=e,[p,h]=(0,a.useState)(!1),m=(0,s.A)(),g=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message}}}(l.error,m),f="> ".concat(g.description,"\n  ").concat(null!=(r=null==(t=g.inset)?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))?r:"","\n  \n\n  Can you fix this error in `").concat(l.artifactId,"`?"),x=d?{label:m.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{h(!0),null==d||d({prompt:f,attachments:[],files:[],syncSources:[]})},disabled:u,loading:p}:void 0;return(0,o.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,o.jsx)(i,{title:g.title,description:g.description,handleClose:c,inset:(null==(n=g.inset)?void 0:n.length)?g.inset?(0,o.jsx)("ul",{children:g.inset.map((e,t)=>(0,o.jsx)("li",{children:e},t))}):null:void 0,action:x})})}},53120:(e,t,n)=>{n.d(t,{x:()=>r});var o=n(21155),a=n(44124);let s=new Map;class r{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=a._s.safeParse(e.data);if(!n.success)return void console.warn("Received message does not conform to basic message shape, ignoring");let o=n.data;if("response"===o.channel)return void this.handleResponse(o);this.messageQueue.push(o),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||s.get(e.requestId);if(void 0!==t){t(e),s.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=o.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,s=o.x8.safeParse(e);if(!s.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let r=s.data;if(this.requestLog.has(r.requestId)){this.sendErrorResponse(r.requestId,400,"Request ID already processed");continue}this.requestLog.set(r.requestId,{message:r,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(r.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(r.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(r,this.boundSendRequest).then(e=>{var t;let n=a.Ko.parse({channel:"response",status:200,requestId:r.requestId,payload:null!=e?e:a.qs}),o=this.requestLog.get(r.requestId);o&&this.requestLog.set(r.requestId,{...o,response:n,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(r.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var o;let s=a.t6.parse({channel:"response",status:t,requestId:e,payload:(0,a.SV)(n)}),r=this.requestLog.get(e);r&&this.requestLog.set(e,{...r,response:s,responseTimestamp:new Date().getTime()}),null==(o=this.iframe.contentWindow)||o.postMessage(s,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,n){return new Promise((r,l)=>{var i,c;let d=Date.now().toString(),u={channel:"request",method:e,requestId:d,payload:t},p=e=>{let t=a.Ko.safeParse(e);if(!t.success)return void l(Error("Invalid response format"));let n=t.data;if(n.status>=400){let e=a.t6.safeParse(n);e.success?l(Error(e.data.payload.error)):l(Error("Error response (".concat(n.status,")")));return}let s=o.v9.safeParse(n);s.success?r(s.data.payload):l(Error("Invalid response payload for the method"))};this.inFlightRequests.set(d,p),s.set(d,p),n&&n.length>0?null==(i=this.iframe.contentWindow)||i.postMessage(u,this.allowedOrigin,n):null==(c=this.iframe.contentWindow)||c.postMessage(u,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:o,onCapabilityAction:a}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=o,this.onCapabilityAction=a,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}}}]);